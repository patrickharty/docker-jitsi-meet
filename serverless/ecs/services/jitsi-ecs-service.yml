Type: AWS::ECS::Service
DependsOn: JitsiALBListener
Properties:
  ServiceName: !Sub ${self:custom.ecsServiceName}
  Cluster: !Ref JitsiECSCluster
  DesiredCount: 1
  LaunchType: FARGATE
  TaskDefinition: !Ref JitsiECSTaskDefinition
  HealthCheckGracePeriodSeconds: 2147483647
  NetworkConfiguration: 
    AwsvpcConfiguration:
      AssignPublicIp: ENABLED
      Subnets:
        - ${self:custom.coreStack.outputs.publicSubnet1}
        - ${self:custom.coreStack.outputs.publicSubnet2}
      SecurityGroups:
        - !Ref JitsiECSSecurityGroup
        - ${self:custom.coreStack.outputs.webAccessSecurityGroup}
  LoadBalancers:
    - ContainerName: ${self:custom.webContainerName}
      ContainerPort: ${self:custom.webContainerHttpPort}
      TargetGroupArn: !Ref JitsiALBTargetGroup
